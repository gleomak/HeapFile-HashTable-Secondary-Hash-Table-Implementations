# <p style="text-align: center;">Υλοποιηση Συστηματων Βασεων Δεδομενων PROJECT 1-2</p>

### Συναρτήσεις HP (σωρού (heap file)) :

#### Γενικά :

- Η δομή **HP_info** αποθηκεύει τον **τύπο** του αρχείου, τον **αριθμό** του αρχείου, τον **αριθμό** 
του **τελευταίου μπλοκ** που πρέπει να γίνει η εκχώρηση, το **offset**(δηλαδή το πόσα byte έχουμε διαθέσιμα για records)
και έναν **pointer** στο **πρώτο block** που θα είναι **pinned** απο τη **HP_OpenFile** μέχρι τη **HP_CloseFile**.
- Η δομή **HP_block_info** αποθηκεύεται στο τέλος κάθε block, και συγκρατεί πληροφορίες που αφορούν 
τον **αριθμό** των **records** που έχει το συγκεκριμένο block, τον **μέγιστο αριθμό εγγραφών** που μπορούν να
αποθηκευτούν στο συγκεκριμένο block, καθώς και έναν **δείκτη** στο επόμενο overflow block.
- H συνάρτηση **printEntries** είναι **βοηθητική** και χρησιμοποιείται σε περίπτωση που θέλουμε να εκτυπώσουμε
όλες τις εγγραφές απο όλα τα block.
- Γίνεται **error_checking** με την **CALL_BF** η οποία επιστρέφει **-1** σε περίπτωση που πάει κάτι **λάθος**.
Για την **HP_OpenFile** χρησιμοποιείται η **CALL_BF2** η οποία επιστρέφει **NULL** σε περίπτωση **λάθους**.

#### HP_CreateFile :

- H **HP_CreateFile** δημιουργεί ενα αρχείο BF με αναγνωριστικό όνομα filename και αρχικοποιούνται οι δομές
**HP_info** και **HP_block_info** που θα μπούνε στο πρώτο μπλοκ και θα χρησιμοποιηθούν καθ'όλη τη διάρκεια εκχώρησης
και εύρεσης εγγραφών. 
- Οι δομές γίνονται copied με τη **memcpy** και έπειτα γίνονται free και το αρχείο κλείνει στο τέλος της συνάρτησης.

#### HP_OpenFile : 

- Στη **HP_OpenFIle** γίνεται re-opened το αρχείο με το χαρακτηριστικό όνομα filename, γίνεται **pinned** το πρώτο block
που περιέχει τη **HP_info** και **ενημερώνεται** το χαρακτηριστικό **fileDesc** του αρχείου
καθώς και ο **pointer** που θα δείχνει στο **πρώτο block**. 
- Έλεγχος για το αν το αρχείο είναι αρχείο με τον αναγνωριστικό τύπο **HP**.

#### HP_CloseFile :

- Στην **HP_CloseFile** , γίνεται **dirty, unpinned & destroyed** το **πρώτο block** του αρχείου και κλείνει
το αρχείο με την βοήθεια της συνάρτησης **BF_CloseFile**.

#### ΗP_InsertEntry : 

- Στη **HP_InsertEntry** γίνεται έλεγχος αμα βρισκόμαστε στο πρώτο block. Αν **Ναι** τότε δεν κάνουμε
**ΒF_GET_BLOCK** καθώς το πρώτο block το έχουμε ήδη στη μνήμη. Ίδιος έλεγχος γίνεται και στο τέλος ώστε να μην γίνει 
**destroyed** το **πρώτο** block και έχουμε προβλήματα στην υλοποίηση.
- Σε περίπτωση που είναι η **πρώτη εγγραφή** ή το **block** που βρισκόμαστε **έχει γεμίσει**, Δημιουργείται ένα επιπλέον block,
αρχικοποιείται, και η εγγραφή αποθηκεύεται στο νέο block. Ενημερώνεται επίσης ο δείκτης του προηγούμενου block ώστε
να δείχνει στο καινούργιο.

#### HP_GetAllEntries :

- Η **HP_GetAllEntries** κάνει **iterate** τα blocks μέχρι να βρεθεί η εγγραφή με το επιθυμητό id και επιστρέφει τον
αριθμό του block που βρέθηκε η εγγραφή. Αν τελειώσει το iteration και δεν βρεθεί η εγγραφή τότε επιστρέφεται -1.


### Συναρτήσεις HT (Hash Table) :

#### Γενικά :

- Η δομή **HT_info** αποθηκεύει τον **τύπο** του αρχείου, τον **αριθμό** του αρχείου, 
το **offset**(δηλαδή το πόσα byte έχουμε διαθέσιμα για records), το **μέγεθος των bucket**, 
έναν **pointer** στο **πρώτο block** που θα είναι **pinned** απο τη **HT_OpenFile** μέχρι τη **HT_CloseFile**,
καθώς και έναν **pointer** σε πίνακα που κρατάει για κάθε **bucket** το **block** που πρέπει να γίνει η εκχώρηση.
- Η δομή **HΤ_block_info** αποθηκεύεται στο τέλος κάθε block, και συγκρατεί πληροφορίες που αφορούν
  τον **αριθμό** των **records** που έχει το συγκεκριμένο block, τον **μέγιστο αριθμό εγγραφών** που μπορούν να
  αποθηκευτούν στο συγκεκριμένο block, τον **αριθμό** του συγκεκριμένου block όταν δημιουργήθηκε, καθώς και έναν
**δείκτη** στον **predecessor** του. Το πρώτο block κάθε bucket *δεν* έχει predecessor οπότε αρχικοποιείται σε -1.
- H συνάρτηση **printΗΤEntries** είναι **βοηθητική** και χρησιμοποιείται σε περίπτωση που θέλουμε να εκτυπώσουμε
  όλες τις εγγραφές απο όλα τα bucket & block.
- Γίνεται **error_checking** με τη **CALL_OR_DIE** η οποία επιστρέφει **-1** σε περίπτωση που πάει κάτι **λάθος**.
  Για τη **HT_OpenFile** χρησιμοποιείται η **CALL_OR_DIE2** η οποία επιστρέφει **NULL** σε περίπτωση **λάθους**.

#### ΗΤ_CreateFile : 

- Η **HT_CreateFile** δημιουργεί ενα αρχείο με όνομα filename, αρχικοποιεί και αποθηκεύει τη δομή **HT_info** στο
πρώτο block, και για **κάθε bucket** δημιουργεί ενα block που θα γίνουν οι πρώτες εκχωρήσεις. Με τη βοήθεια 
και την αρχικοποίηση του πίνακα **bucketToLastBlock** κάθε bucket θα δείχνει στο αρμόδιο block.
- Κλείσιμο file και free σε όποια δομή χρησιμοποιήσαμε και δε χρειαζόμαστε περαιτέρω.

#### ΗΤ_OpenFile : 

- Στη **HT_OpenFIle** γίνεται re-opened το αρχείο με το χαρακτηριστικό όνομα filename, γίνεται **pinned** το πρώτο block
που περιέχει τη **HT_info** και **ενημερώνεται** το χαρακτηριστικό **fileDesc** του αρχείου 
καθώς και ο **pointer** που θα δείχνει στο pinned **πρώτο block**.
- Έλεγχος για το αν το αρχείο είναι αρχείο με τον αναγνωριστικό τύπο **HT**.

#### HT_CloseFile : 

- Στη **ΗΤ_CloseFile** κάνουμε **free** τον πίνακα **bucketToLastBlock** , κάνουμε dirty-unpin-destroy το πρώτο block
του πίνακα και κλείνουμε το αρχείο .

#### ΗΤ_InsertEntry :

- Για την εκχώρηση του record κάνουμε **hash** το **record.id** του εκάστοτε record και βρίσκουμε με τη
βοήθεια του πίνακα ποιο είναι το τελευταίο block του bucket που βρήκαμε. 
- Ανακτούμε το block που μας έδωσε ο πίνακας και ελέγχουμε αν έχει χώρο για εκχώρηση. Αν **οχι** τότε δημιουργούμε ένα
καινούργιο block και του εκχωρούμε την εγγραφή. Έπειτα *ανανεώνουμε* τον *πίνακα* ώστε να δείχνει στο **καινούργιο block**
και το **καινούργιο block** να **δείχνει** στο *προηγούμενο κάτοχο της τελευταίας θέσης του συγκεκριμένου bucket*.

#### HT_GetAllEntries

- Η **HT_GetAllEntries** κάνει hash το value που θα της δωθεί και βρίσκει το **τελευταίο block**
του συγκεκριμένου **bucket**, ανακτώντας τα στοιχεία του. Έπειτα γίνεται ενα iteration με μια **while** το οποίο τρέχει είτε μέχρι να βρεθεί το
συγκεκριμένο id και να γίνουν returned τα πόσα block διαβάστηκαν είτε μέχρι να ελεγχθεί **και** το πρώτο block του 
bucket και να έχουμε εξαντλήσει τα entries ώστε να βρούμε το id και τελικά να γίνεται returned **-1**.

### Συναρτήσεις SHT (Secondary Hash Table)

#### Γενικά:

- Η δομή **SHT_info** αποθηκεύει τον **τύπο** του αρχείου, τον **αριθμό** του αρχείου,
  το **offset**(δηλαδή το πόσα byte έχουμε διαθέσιμα για records), το **μέγεθος των bucket**,
  έναν **pointer** στο **πρώτο block** που θα είναι **pinned** απο τη **SHT_OpenFile** μέχρι τη **SHT_CloseFile**,
  καθώς και έναν **pointer** σε πίνακα που κρατάει για κάθε **bucket** το **block** που πρέπει να γίνει η εκχώρηση.
- Η δομή **SHΤ_block_info** αποθηκεύεται στο τέλος κάθε block, και συγκρατεί πληροφορίες που αφορούν
  τον **αριθμό** των **records** που έχει το συγκεκριμένο block, τον **μέγιστο αριθμό εγγραφών** που μπορούν να
  αποθηκευτούν στο συγκεκριμένο block, τον **αριθμό** του συγκεκριμένου block όταν δημιουργήθηκε, καθώς και έναν
  **δείκτη** στον **predecessor** του. Το πρώτο block κάθε bucket *δεν* έχει predecessor οπότε αρχικοποιείται σε -1.
- H συνάρτηση **printSΗΤEntries** είναι **βοηθητική** και χρησιμοποιείται σε περίπτωση που θέλουμε να εκτυπώσουμε
  όλες τις εγγραφές απο όλα τα bucket & block.
- Γίνεται **error_checking** με τη **CALL_OR_DIE** η οποία επιστρέφει **-1** σε περίπτωση που πάει κάτι **λάθος**.
  Για τη **SHT_OpenFile** χρησιμοποιείται η **CALL_OR_DIE2** η οποία επιστρέφει **NULL** σε περίπτωση **λάθους**.

#### SHT_CreateSecondaryIndex:

- Η **SHT_CreateSecondaryIndex** δημιουργεί ενα αρχείο με όνομα filename, αρχικοποιεί και αποθηκεύει τη δομή **SHT_info** στο
  πρώτο block, και για **κάθε bucket** δημιουργεί ενα block που θα γίνουν οι πρώτες εκχωρήσεις. Με τη βοήθεια
  και την αρχικοποίηση του πίνακα **bucketToLastBlock** κάθε bucket θα δείχνει στο αρμόδιο block.
- Κλείσιμο file και free σε όποια δομή χρησιμοποιήσαμε και δε χρειαζόμαστε περαιτέρω.

#### SHT_OpenSecondaryIndex:

- Στη **SHT_OpenSecondaryIndex** γίνεται re-opened το αρχείο με το χαρακτηριστικό όνομα filename, γίνεται **pinned** το πρώτο block
  που περιέχει τη **SHT_info** και **ενημερώνεται** το χαρακτηριστικό **fileDesc** του αρχείου
  καθώς και ο **pointer** που θα δείχνει στο pinned **πρώτο block**.
- Έλεγχος για το αν το filename είναι αρχείο με τον αναγνωριστικό τύπο **SHT**. 

#### SHT_CloseSecondaryIndex:

- Στη **SHT_CloseSecondaryIndex** κάνουμε **free** τον πίνακα **bucketToLastBlock** , κάνουμε dirty-unpin-destroy το πρώτο block
  του πίνακα και κλείνουμε το αρχείο .

#### SHT_SecondaryInsertEntry:

- Κάθε **entry** είναι ένα **shtTuple** το οποίο αποτελείται απο το όνομα του record και ενα **blockIndex** το οποίο είναι
ο αριθμός του μπλοκ απο το **ΗΤ file** στο οποίο έχει εκχωρηθεί το record.
- Το κάθε tuple εκχωρείται στο bucket που γυρνάει καλώντας τη **SHT_HashFunction** η οποία χασάρει το όνομα του εκάστοτε record.
Αν το **last Block** του bucket είναι **γεμάτο** τότε δημιουργείται ενα καινούργιο μπλοκ και ανανεώνονται οι δομές σε παρόμοιο
στυλ με το HT.

#### SHT_SecondaryGetAllEntries:

- Η **SHT_SecondaryGetAllEntries** κάνει hash το name που θα της δωθεί και βρίσκει το **τελευταίο block**
του συγκεκριμένου **bucket**, ανακτώντας τα στοιχεία του. Έπειτα γίνεται ενα iteration με μια **while** η οποία
ψάχνει σε κάθε block που είναι συνδεδεμένο με το συγκεκριμένο bucket να βρει εγγραφή με το name. Αν ένα **shtTuple**
περιέχει το name τότε πάμε και ανοίγουμε το **shtTuple.blockIndex** του **HT file** και εκτυπώνουμε **κάθε record** που
περιέχει το συγκεκριμένο όνομα. 
- Στον πίνακα **visited Array** κρατάμε τα **block** απο το **HT file** που έχουμε **επισκεφτεί**. Αυτό μας προστατεύει
απο την περίπτωση να υπάρχουν δυο(ή περισσότερα) ίδια entries στο sht file (πχ (George,10),(George,10)) το οποίο αν δεν
είχαμε τον πίνακα στο δεύτερο (George,10) θα **ξανά-εκτυπώναμε** τις εγγραφές που υπάρχουν στο **10ο block** του **ΗΤ File**.
  
